# フロントエンド

フロントエンドは Next.js 14 と React 18 を用いたアプリケーションで、アップロード管理・変換トリガー・生成結果の編集 UI を提供します。スタイリングは Tailwind CSS とクラスユーティリティを利用しています。

## 構成
- `app/page.tsx`: SWR を使ったデータ取得、選択状態の管理、アップロード・変換操作、レイアウト描画を担うメインコンポーネント。
- `components/`
  - `Header`: サイドバー切り替えボタンを持つレスポンシブヘッダー。
  - `NotesTimeline`: アップロード一覧とコンテキストアクション、進捗表示、モデル選択（Qwen / Deepseek / Chandra）を行うサイドバー。
  - `FilePreview`: 選択中のアップロードまたはドキュメントに紐づくオリジナルファイルをプレビュー（ズームコントロール付き）。
  - `DocumentEditor`: Markdown / LaTeX エディタとレイアウトビューアを統合し、ストリーミング風描画と自動保存を提供。
  - `DocumentList`: タイムライン内部で利用する補助的なドキュメントリスト。
- `lib/api.ts`: アップロード・削除・変換・更新・モデル一覧取得などの API 呼び出しヘルパー。
- `lib/latexPreview.ts`: LaTeX 文字列をプレビュー用の Markdown に整形し、`DocumentEditor` 内でのプレビュー統合に利用します。
- `types/`: バックエンドのスキーマと整合する TypeScript 型定義。

## データ取得と状態管理
- SWR が `/api/files` `/api/documents` `/api/models` をキャッシュし、ミューテーション時に再検証します。
- ローカル状態で選択中のアップロード／ドキュメント、アップロード別の進捗、選択モデル、サイドバー開閉、ストリーミング対象ドキュメント ID を保持します。
- 変換開始時にプログレスバーをタイマーで更新し、完了後は最初の生成ドキュメントを自動でアクティブ化してストリーミング表示します。
- `DocumentEditor` は 600ms のディレイで自動保存を実行し、ストリーミング再生中やレイアウト JSON 未読込時は保存を抑制します。
- レイアウトドキュメントはページタブで切り替え、ページ画像と OCR テキストのオーバーレイプレビューを提供します。

## UX のポイント
- 小さな画面ではサイドバーを自動で折りたたみ、ヘッダーから切り替えできます。
- Markdown / LaTeX プレビューは `react-markdown` + `remark-gfm` + `remark-math` + `rehype-katex` を利用し、align 系数式は `aligned` 環境へ正規化して表示します。
- レイアウトプレビューはページ画像の上にテキスト領域を重ね、ズーム可能なオーバーレイとして表示します。
- 生成結果とオリジナルファイルの両方を API エンドポイントからダウンロードできます。

## 環境変数
`NEXT_PUBLIC_API_URL`（Docker Compose で設定）にバックエンドのベース URL を指定します。ダウンロードリンクを別ドメインに向けたい場合は `NEXT_PUBLIC_DOWNLOAD_URL` も併せて設定してください。
